{% extends 'base_hr_authenticated.html' %}
{% block title %}HR Homepage{% endblock %}
{% block content %}

    <link rel="stylesheet" href="{{ url_for('static', filename='static/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="{{ url_for('static', filename='static/js/sort_table.js') }}" defer></script>
    <script src="{{ url_for('static', filename='static/js/details.js') }}"></script>
    <div class="text-center">
        <h1>Welcome To Your Dashboard, {{ hr_name }} {{ hr_surname }}</h1>
        <h2>Company: {{ company_name }}</h2>
        <h2>My Overview</h2>
    </div>
        <div class="kpi-container">
            <div class="kpi">
                <h4>Total Interviews Created</h4>
                <p>{{ total_interviews }}</p>
            </div>
            <div class="kpi">
                <h4>Total Interviews Conducted</h4>
                <p>{{ total_sessions }}</p>
            </div>
            <div class="kpi">
                <h4>Total Applicants</h4>
                <p>{{ total_applicants }}</p>
            </div>
        </div>
    <div class="dashboard">
        <h2>My Interviews</h2>
        <div class="scrollable-table">
        <div class="table-container">
            {% if interview_data %}
            <table>
                <thead>
                    <tr>
                        <th class="sortable">Created At</td>
                        <th class="sortable">Industry</td>
                        <th>Role</th>
                        <th>Situation(s)</th>
                        <th class="sortable"> Language</td>
                        <th>Duration</th>
                        <th>Max Questions</th>
                        <th class="sortable">Number of Sessions</td>
                        <th>Link</th>
                    </tr>
                </thead>
                <tbody>
                    {% for interview in interview_data %}
                    <tr>
                        <td>{{ interview.created_at.strftime('%d-%m-%Y at %H:%M:%S') }}</td>
                        <td>{{ interview.industry }}</td>
                        <td>{{ interview.role }}</td>
                        <td>
                            <ul>
                                {% for situation in interview.situation %}
                                <li>{{ situation }}</li>
                                {% endfor %}
                            </ul>
                        </td>
                        <td>{{ interview.language }}</td>
                        <td>{{ interview.duration }} min</td>
                        <td align="center">{{ interview.max_questions }}</td>
                        <td align="center">{{ interview.sessions_count }}</td>
                        <td><a href="{{ url_for('main.applicant_home', hr_id = hr_id, interview_parameter_id=interview.interview_parameter_id) }}" target="_blank">Link</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>You still have not created any interview.</p>
            {% endif %}
        </div>
        </div>
    </div>

        {% if interview_data %}
    <div class="dashboard">
        <h2>My Interview details</h2>
        <div class="interview-details">
            {% for interview in interview_data %}
            <div class="interview-card">
                <h4>Interview for: {{ interview.role }} position in the {{ interview.industry }} industry</h4>
                <div class="scrollable-table">
                <table>
                    <thead>
                        <tr>
                            <th class="sortable">Name</th>
                            <th class="sortable">Surname</th>
                            <th class="sortable">Email</th>
                            <th class="sortable">Start Time</th>
                            <th class="sortable">Mean Criteria Score</th>
                            <th>See Details</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for session in interview.sessions %}
                        <tr>
                            <td>{{ session.applicant_name }}</td>
                            <td>{{ session.applicant_surname }}</td>
                            <td>{{ session.applicant_email }}</td>
                            <td>{{ session.start_time.strftime('%d-%m-%Y at %H:%M:%S') }}</td>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: {{ session.mean_score * 10 }}%;" aria-valuenow="{{ session.mean_score * 10 }}" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </td>
                            <td><a href="{{ url_for('main.session_details', hr_id=hr_id, session_id=session.id) }}">See Details</a></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <script src="{{ url_for('static', filename='js/sortable.js') }}"></script>

{% endblock %}
