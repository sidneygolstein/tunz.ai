{% extends 'base_hr_authenticated.html' %}
{% block title %}Comparison Details{% endblock %}
{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='static/styles.css') }}">
<script src="{{ url_for('static', filename='static/js/sort_table.js') }}" defer></script>
<div class="dashboard">
    <h2>Comparison Details for {{ interview_parameters.role }} Position</h2>
    <div class="scrollable-table">
        <table id="comparison-table">
            <thead>
                <tr>
                    <th class="sortable" onclick="sortTable(0)">Name</th>
                    <th class="sortable" onclick="sortTable(1)">Surname</th>
                    <th class="sortable" style="width: 15%;" onclick="sortTable(2, true)">Communication Skills</th>
                    <th class="sortable" style="width: 15%;" onclick="sortTable(3, true)">Logical Reasoning & Structure and Problem Solving</th>
                    <th class="sortable" style="width: 15%;" onclick="sortTable(4, true)">Creativity</th>
                    <th class="sortable" style="width: 15%;" onclick="sortTable(5, true)">Business Acumen</th>
                    <th class="sortable" style="width: 15%;" onclick="sortTable(6, true)">Analytical Skills</th>
                    <th class="sortable" style="width: 15%;" onclick="sortTable(7, true)">Project Management and Prioritization</th>
                    <th class="sortable" style="width: 15%;" onclick="sortTable(8, true)">Mean Evaluation</th>
                    <th>See Details</th>
                </tr>
            </thead>
            <tbody>
                {% for session in comparison_data %}
                    <tr>
                        <td>{{ session.applicant_name }}</td>
                        <td>{{ session.applicant_surname }}</td>
                        {% for criterion, value in session.criteria_scores.items() %}
                            <td data-value="{{ value }}">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" 
                                         style="width: {{ value * 10 }}%; 
                                                background-color: {{ get_color(value) }};" 
                                         aria-valuenow="{{ value * 10 }}" aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </td>
                        {% endfor %}
                        <td data-value="{{ session.mean_score }}">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: {{ session.mean_score * 10 }}%; 
                                            background-color: {{ get_color(session.mean_score) }};" 
                                     aria-valuenow="{{ session.mean_score * 10 }}" aria-valuemin="0" aria-valuemax="100">
                                </div>
                            </div>
                        </td>
                        <td>
                            <a href="{{ url_for('main.session_details', hr_id=hr_id, session_id=session.id) }}">See Details</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function sortTable(columnIndex, isNumeric = false) {
        const table = document.getElementById('comparison-table');
        const tbody = table.getElementsByTagName('tbody')[0];
        const rows = Array.from(tbody.rows);
        const ascending = table.dataset.sortOrder !== 'asc';

        rows.sort((a, b) => {
            const aValue = isNumeric ? parseFloat(a.cells[columnIndex].getAttribute('data-value')) : a.cells[columnIndex].textContent;
            const bValue = isNumeric ? parseFloat(b.cells[columnIndex].getAttribute('data-value')) : b.cells[columnIndex].textContent;

            return ascending ? (aValue > bValue ? 1 : -1) : (aValue < bValue ? 1 : -1);
        });

        rows.forEach(row => tbody.appendChild(row));
        table.dataset.sortOrder = ascending ? 'asc' : 'desc';
    }
</script>

{% endblock %}
